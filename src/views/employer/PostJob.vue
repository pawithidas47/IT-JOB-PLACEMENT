<template>
  <div>
    <NavbarEmployer />

    <div class="container py-5">
      <div class="form-box shadow rounded-4 p-4 bg-white mx-auto" style="max-width: 750px;">
        <h4 class="fw-bold mb-4 text-orange">üìù ‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h4>

        <form @submit.prevent="submitJob" class="row g-3">
  <!-- 1. ‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô -->
  <div class="col-12">
    <label class="form-label fw-bold">‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô</label>
    <input v-model="job.title" class="form-control rounded-3" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" required />
  </div>
<div class="col-12">
            <label class="form-label fw-bold">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏á‡∏≤‡∏ô</label>
            <select v-model="job.category" class="form-select rounded-3" required>
  <option disabled value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà --</option>
              <option value="‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏°‡∏±‡∏•‡∏ï‡∏¥‡∏°‡∏µ‡πÄ‡∏î‡∏µ‡∏¢">‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏°‡∏±‡∏•‡∏ï‡∏¥‡∏°‡∏µ‡πÄ‡∏î‡∏µ‡∏¢</option>
              <option value="‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•">‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•</option>
              <option value="‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå">‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</option>
              <option value="UX/UI Design">UX/UI Design</option>
              <option value="IT Support">IT Support</option>
              <option value="‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢">‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢</option>
              <option value="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°/ ‡πÅ‡∏õ‡∏•‡∏ö‡∏ó‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡πà">‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô/ ‡πÅ‡∏õ‡∏•‡∏ö‡∏ó‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡πà</option>
              <option value="‡∏Ñ‡∏µ‡∏¢‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• / Data Entry">‡∏Ñ‡∏µ‡∏¢‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• / Data Entry</option>
              <option value="‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏û‡∏à / ‡∏î‡∏π‡πÅ‡∏•‡πÇ‡∏ã‡πÄ‡∏ä‡∏µ‡∏¢‡∏•‡∏°‡∏µ‡πÄ‡∏î‡∏µ‡∏¢">‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏û‡∏à / ‡πÇ‡∏ã‡πÄ‡∏ä‡∏µ‡∏¢‡∏•‡∏°‡∏µ‡πÄ‡∏î‡∏µ‡∏¢</option>
              <option value="‡∏ï‡∏±‡∏î‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ / ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå">‡∏ï‡∏±‡∏î‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ / ‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå</option>
              <option value="‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡πà">‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡πà</option>
            </select>
          </div>
  <!-- 2. ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô -->
  <div class="col-12">
    <label class="form-label fw-bold">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô</label>
    <textarea v-model="job.description" class="form-control rounded-3" rows="4" placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°" required></textarea>
  </div>

 

  <!-- 4. ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ -->
  <!-- 4. ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ -->
<div class="col-12">
  <label class="form-label fw-bold">‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</label>
  <textarea v-model="job.qualification" class="form-control rounded-3" rows="4" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏µ‡πÇ‡∏ô‡πâ‡∏ï‡∏ö‡∏∏‡πä‡∏Å, ‡πÉ‡∏ä‡πâ Photoshop ‡πÑ‡∏î‡πâ\n- ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤‡∏¢ IT\n- ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡∏°‡πÑ‡∏î‡πâ‡∏î‡∏µ"></textarea>
</div>
 <!-- 3. ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö -->
  <div class="col-md-6">
    <label class="form-label fw-bold">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö</label>
    <input v-model="job.vacancy" class="form-control rounded-3" placeholder="‡πÄ‡∏ä‡πà‡∏ô 3 ‡∏≠‡∏±‡∏ï‡∏£‡∏≤" />
  </div>

  <!-- 6. ‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô -->
  <div class="col-md-6">
    <label class="form-label fw-bold">‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á</label>
    <input v-model="job.salary" class="form-control rounded-3" placeholder="‡πÄ‡∏ä‡πà‡∏ô 50 ‡∏ö‡∏≤‡∏ó/‡∏ä‡∏°." required />
  </div>

  <!-- 7. ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏á‡∏≤‡∏ô -->
  <div class="col-md-6">
    <label class="form-label fw-bold">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏á‡∏≤‡∏ô</label>
    <input v-model="job.duration" class="form-control rounded-3" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1 ‡∏Å.‡∏Ñ. - 30 ‡∏™.‡∏Ñ." />
  </div>

  <!-- 8. ‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô -->
  <div class="col-md-6">
    <label class="form-label fw-bold">‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</label>
    <input v-model="job.working_time" class="form-control rounded-3" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏à.-‡∏®. 9:00-17:00" />
  </div>

  <!-- 9. ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô -->
  <div class="col-md-6">
    <label class="form-label fw-bold">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</label>
    <input v-model="job.location" class="form-control rounded-3" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå / ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø" />
  </div>


  
  <div class="col-12">
    <button type="submit" class="btn btn-orange w-100 fw-bold py-2">üì® ‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏á‡∏≤‡∏ô</button>
  </div>
</form>

      </div>

      <!-- Preview -->
      <div v-if="job.j_title" class="mt-5">
        <h5 class="mb-3 fw-bold text-orange">üëÄ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå</h5>
        <div class="border rounded-3 shadow-sm p-4 bg-light">
          <h6 class="fw-bold mb-1">{{ job.j_title }}</h6>
          <p class="mb-1 text-muted">{{ job.j_type }}</p>
          <p class="mb-1"><strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong> {{ job.detail }}</p>
          <p><strong>‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</strong> {{ job.contact }} | üí∞ {{ job.j_salary?.toLocaleString() }} ‡∏ö‡∏≤‡∏ó | ‚è≥ {{
            job.duration }}</p>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import NavbarEmployer from "@/components/NavbarEmployer.vue";

export default {
  components: { NavbarEmployer },
  data() {
    return {
      job: {
        title: "",
        description: "",
        category: "",
        vacancy: "",
        qualification: "",
        salary: "",
        duration: "",
        working_time: "",
        location: "",
        welfare: "",
        deliverable: "",
        contact: "",
        deadline: ""
      },
      user: null,
      files: [],
    };
  },
  mounted() {
    const u = localStorage.getItem("user");
    if (!u) return this.$router.push("/login");
    this.user = JSON.parse(u);

    // ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (optional)
    if (this.job.deadline) {
      const date = new Date(this.job.deadline);
      const yyyy = date.getFullYear();
      const mm = String(date.getMonth() + 1).padStart(2, "0");
      const dd = String(date.getDate()).padStart(2, "0");
      this.job.deadline = `${yyyy}-${mm}-${dd}`;
    }
  },
  methods: {
    handleFileUpload(e) {
      this.files = [...e.target.files];
    },
    submitJob() {
const payload = {
  j_title: this.job.title,
  j_description: this.job.description,
  j_type: this.job.category,
  j_salary: this.job.salary,
  j_appdeadline: this.job.deadline,
  j_amount: this.job.vacancy,
  j_duration: this.job.duration,
  j_worktime: this.job.working_time,
  j_location: this.job.location,
  j_welfare: this.job.welfare,
  j_deliverable: this.job.deliverable,
  j_contact: this.job.contact,
  j_qualification: this.job.qualification, // ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ
  employer_id: this.user.employer_id
};


  const formData = new FormData();
  Object.entries(payload).forEach(([key, value]) => {
    formData.append(key, value);
  });

  this.$axios.post("http://localhost:3001/api/jobs", formData)
    .then(() => {
      alert("‚úÖ ‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      this.$router.push("/employer/dashboard");
    })
    .catch(err => {
      console.error("‚ùå ‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:", err);
      alert("‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    });
}

    
  }
};
</script>


<style scoped>
.text-orange {
  color: #ff6600;
}

.form-box {
  background: #fff;
  border: 1px solid #eee;
}

.btn-orange {
  background-color: #ff6600;
  color: white;
  transition: all 0.2s ease-in-out;
  border: none;
}

.btn-orange:hover {
  background-color: #e65c00;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(255, 102, 0, 0.25);
}
</style>
