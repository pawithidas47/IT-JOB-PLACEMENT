<template>
  <div>
    <NavbarEmployer />

    <div class="container py-6">
      <div class="card mx-auto" style="max-width: 920px">
        <h4 class="title">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏á‡∏≤‡∏ô</h4>

        <div v-if="loaded">
          <form @submit.prevent="submitEdit" class="grid gap-5">
            <!-- ‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô / ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà -->
            <div class="grid grid-2 gap-4">
              <div>
                <label class="label">‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô <span class="req">*</span></label>
                <input v-model.trim="job.title" class="input" required />
              </div>

              <div>
                <label class="label">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà <span class="req">*</span></label>
                <select v-model="job.category" class="select" required>
                  <option disabled value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà ‚Äî</option>
                  <option value="‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏°‡∏±‡∏•‡∏ï‡∏¥‡∏°‡∏µ‡πÄ‡∏î‡∏µ‡∏¢">‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏°‡∏±‡∏•‡∏ï‡∏¥‡∏°‡∏µ‡πÄ‡∏î‡∏µ‡∏¢</option>
                  <option value="UX/UI Design">UX/UI Design</option>
                  <option value="‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå">‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</option>
                  <option value="‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô">‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô</option>
                  <option value="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°/ ‡πÅ‡∏õ‡∏•‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°">‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô/ ‡πÅ‡∏õ‡∏•‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°</option>
                  <option value="‡∏Ñ‡∏µ‡∏¢‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• / Data Entry">‡∏Ñ‡∏µ‡∏¢‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• / Data Entry</option>
                  <option value="‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏û‡∏à / ‡∏î‡∏π‡πÅ‡∏•‡πÇ‡∏ã‡πÄ‡∏ä‡∏µ‡∏¢‡∏•‡∏°‡∏µ‡πÄ‡∏î‡∏µ‡∏¢">‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏û‡∏à / ‡πÇ‡∏ã‡πÄ‡∏ä‡∏µ‡∏¢‡∏•‡∏°‡∏µ‡πÄ‡∏î‡∏µ‡∏¢</option>
                  <option value="‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•">‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•</option>
                  <option value="IT Support">IT Support</option>
                  <option value="‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢">‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢</option>
                  <option value="‡∏ï‡∏±‡∏î‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ / ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå">‡∏ï‡∏±‡∏î‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ / ‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå</option>
                  <option value="‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ">‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ</option>
                </select>
              </div>
            </div>

            <!-- ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î / ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥ -->
            <div class="grid grid-2 gap-4">
              <div>
                <label class="label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô</label>
                <textarea v-model.trim="job.description" class="input" rows="4"
                          placeholder="‡∏™‡∏£‡∏∏‡∏õ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏° (bullet ‡πÑ‡∏î‡πâ)"></textarea>
              </div>
              <div>
                <label class="label">‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</label>
                <textarea v-model.trim="job.qualification" class="input" rows="4"
                          placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏µ‡πÇ‡∏ô‡πâ‡∏ï‡∏ö‡∏∏‡πä‡∏Å, ‡πÉ‡∏ä‡πâ Photoshop ‡πÑ‡∏î‡πâ, ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡∏°"></textarea>
              </div>
            </div>

            <!-- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö -->
            <div class="grid grid-2 gap-4">
              <div>
                <label class="label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö</label>
                <input v-model.trim="job.vacancy" class="input" placeholder="‡πÄ‡∏ä‡πà‡∏ô 3 ‡∏≠‡∏±‡∏ï‡∏£‡∏≤" />
              </div>
            </div>

            <!-- ‡∏ä‡∏ô‡∏¥‡∏î‡∏á‡∏≤‡∏ô -->
            <div>
              <label class="label">‡∏ä‡∏ô‡∏¥‡∏î‡∏á‡∏≤‡∏ô</label>
              <div class="chips">
                <button type="button" class="chip" :class="{active: ui.kind==='‡∏á‡∏≤‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß'}"
                        @click="setKind('‡∏á‡∏≤‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß','‡πÄ‡∏´‡∏°‡∏≤‡∏á‡∏≤‡∏ô')">‡∏á‡∏≤‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</button>
                <button type="button" class="chip" :class="{active: ui.kind==='‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á'}"
                        @click="setKind('‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á','‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á')">‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</button>
                <button type="button" class="chip" :class="{active: ui.kind==='‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÑ‡∏ó‡∏°‡πå(‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô)'}"
                        @click="setKind('‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÑ‡∏ó‡∏°‡πå(‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô)','‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô')">‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÑ‡∏ó‡∏°‡πå (‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô)</button>
                <button type="button" class="chip" :class="{active: ui.kind==='‡∏ü‡∏π‡∏•‡πÑ‡∏ó‡∏°‡πå(‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)'}"
                        @click="setKind('‡∏ü‡∏π‡∏•‡πÑ‡∏ó‡∏°‡πå(‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)','‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô')">‡∏ü‡∏π‡∏•‡πÑ‡∏ó‡∏°‡πå (‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)</button>
              </div>
            </div>

            <!-- ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏á‡∏≤‡∏ô -->
            <div>
              <label class="label">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏á‡∏≤‡∏ô</label>
              <div class="chips">
                <button type="button" class="chip" :class="{active: ui.durationPreset==='‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á'}"
                        @click="ui.durationPreset='‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á'">‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á</button>
                <button type="button" class="chip" :class="{active: ui.durationPreset==='1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'}"
                        @click="ui.durationPreset='1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'">1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
                <button type="button" class="chip" :class="{active: ui.durationPreset==='3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'}"
                        @click="ui.durationPreset='3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'">3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
                <button type="button" class="chip" :class="{active: ui.durationPreset==='6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'}"
                        @click="ui.durationPreset='6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'">6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
                <button type="button" class="chip" :class="{active: ui.durationPreset==='‡∏á‡∏≤‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß'}"
                        @click="ui.durationPreset='‡∏á‡∏≤‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß'">‡∏á‡∏≤‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</button>
              </div>

              <div v-if="ui.durationPreset==='‡∏á‡∏≤‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß'" class="mt-2">
                <label class="label sub">‡∏ß‡∏±‡∏ô‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                <input type="date" v-model="ui.dueDate" class="input"/>
              </div>
            </div>

            <!-- ‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô -->
            <div>
              <label class="label">‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</label>

              <div class="chips mb-2">
                <button type="button" class="chip" @click="selectWeekdays">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏à.-‡∏®.</button>
                <button type="button" class="chip" @click="toggleAllDays">‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô</button>
              </div>

              <div class="days">
                <button v-for="d in days" :key="d.key" type="button"
                        class="day" :class="{active: ui.daysSelected.includes(d.key)}"
                        @click="toggleDay(d.key)">{{ d.label }}</button>
              </div>

              <div class="grid grid-2 gap-4 mt-2">
                <div>
                  <label class="label sub">‡πÄ‡∏£‡∏¥‡πà‡∏°</label>
                  <input type="time" v-model="ui.startTime" class="input" />
                </div>
                <div>
                  <label class="label sub">‡πÄ‡∏•‡∏¥‡∏Å</label>
                  <input type="time" v-model="ui.endTime" class="input" />
                </div>
              </div>
            </div>

            <!-- ‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô -->
            <div>
              <label class="label">‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô</label>
              <div class="grid grid-3 gap-4">
                <div>
                  <select v-model="job.salary_type" class="select">
                    <option disabled value="">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á</option>
                    <option value="‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á">‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                    <option value="‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô">‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</option>
                    <option value="‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô">‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
                    <option value="‡πÄ‡∏´‡∏°‡∏≤‡∏á‡∏≤‡∏ô">‡πÄ‡∏´‡∏°‡∏≤‡∏á‡∏≤‡∏ô</option>
                    <option value="‡∏ï‡∏≤‡∏°‡∏ï‡∏Å‡∏•‡∏á">‡∏ï‡∏≤‡∏°‡∏ï‡∏Å‡∏•‡∏á</option>
                  </select>
                </div>
                <div v-if="job.salary_type !== '‡∏ï‡∏≤‡∏°‡∏ï‡∏Å‡∏•‡∏á'">
                  <input type="number" min="0" class="input" v-model.number="job.salary_min" placeholder="‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥" />
                </div>
                <div v-if="job.salary_type !== '‡∏ï‡∏≤‡∏°‡∏ï‡∏Å‡∏•‡∏á'">
                  <input type="number" min="0" class="input" v-model.number="job.salary_max" placeholder="‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á" />
                </div>
              </div>
            </div>

            <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å -->
            <div class="summary">
              <div class="sum-item">
                <div class="sum-title">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ </div>
                <div class="sum-val">{{ jDurationString || '‚Äî' }}</div>
              </div>
              <div class="sum-item">
                <div class="sum-title">‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô </div>
                <div class="sum-val">{{ jWorktimeString || '‚Äî' }}</div>
              </div>
              <div class="sum-item">
                <div class="sum-title">‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô </div>
                <div class="sum-val">{{ jSalaryString || '‚Äî' }}</div>
              </div>
            </div>

            <!-- ‡∏õ‡∏∏‡πà‡∏° -->
            <div class="grid gap-4">
              <button class="btn-primary" type="submit">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
              <button class="btn-outline" type="button" @click="cancelEdit">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
          </form>
        </div>

        <div v-else class="text-center text-muted py-5">
          <i class="bi bi-hourglass-split fs-2"></i>
          <p class="mt-3">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô...</p>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import axios from "axios";
import NavbarEmployer from "@/components/NavbarEmployer.vue";

export default {
  name: "EditJobBetter",
  components: { NavbarEmployer },
  data() {
    return {
      loaded: false,
      apiJob: null, // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏à‡∏≤‡∏Å API
      job: {
        title: "",
        category: "",
        description: "",
        qualification: "",
        vacancy: "",
        salary_type: "",
        salary_min: null,
        salary_max: null,
      },
      ui: {
        kind: "‡∏á‡∏≤‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß",
        durationPreset: "‡∏á‡∏≤‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß",
        dueDate: "",
        daysSelected: ["‡∏à", "‡∏≠", "‡∏û", "‡∏û‡∏§", "‡∏®"],
        startTime: "09:00",
        endTime: "17:00",
      },
      days: [
        { key: "‡∏≠‡∏≤", label: "‡∏≠‡∏≤" },
        { key: "‡∏à", label: "‡∏à" },
        { key: "‡∏≠", label: "‡∏≠" },
        { key: "‡∏û", label: "‡∏û" },
        { key: "‡∏û‡∏§", label: "‡∏û‡∏§" },
        { key: "‡∏®", label: "‡∏®" },
        { key: "‡∏™", label: "‡∏™" },
      ],
    };
  },
  computed: {
    jDurationString() {
      const p = this.ui.durationPreset;
      if (!p) return "";
      if (p === "‡∏á‡∏≤‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß") {
        if (this.ui.dueDate) return `‡∏á‡∏≤‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (‡∏™‡πà‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ${this.thaiDate(this.ui.dueDate)})`;
        return "‡∏á‡∏≤‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß";
      }
      return p === "‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á" ? "‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á" : p;
    },
    jWorktimeString() {
      const ds = this.ui.daysSelected.slice();
      if (!ds.length) return "";
      const isWeekdays = ds.length === 5 && ["‡∏à", "‡∏≠", "‡∏û", "‡∏û‡∏§", "‡∏®"].every((k) => ds.includes(k));
      const dayPart = isWeekdays ? "‡∏à.-‡∏®." : ds.join(", ");
      const tPart = this.ui.startTime && this.ui.endTime ? `${this.ui.startTime} ‚Äì ${this.ui.endTime}` : "";
      return [dayPart, tPart].filter(Boolean).join(" ");
    },
    jSalaryString() {
      const t = this.job.salary_type;
      if (!t) return "";
      if (t === "‡∏ï‡∏≤‡∏°‡∏ï‡∏Å‡∏•‡∏á") return "‡∏ï‡∏≤‡∏°‡∏ï‡∏Å‡∏•‡∏á";
      const min = this.job.salary_min != null && this.job.salary_min !== "" ? Number(this.job.salary_min).toLocaleString() : null;
      const max = this.job.salary_max != null && this.job.salary_max !== "" ? Number(this.job.salary_max).toLocaleString() : null;
      if (min && max) return `${t} ${min} ‚Äì ${max}`;
      if (min) return `${t} ${min}+`;
      if (max) return `${t} ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ${max}`;
      return t;
    },
  },
  async mounted() {
    const id = this.$route.params.id;
    try {
      const { data } = await axios.get(`http://localhost:3001/api/jobs/${id}`);
      this.apiJob = data;
      this.hydrateFormFromApi(data); // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡πà‡∏≤‡∏•‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏û‡∏™
      this.loaded = true;
    } catch (e) {
      console.error("‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:", e);
      alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ");
      this.$router.push("/employer/dashboard");
    }
  },
  methods: {
    // ---------- Helpers ----------
    thaiDate(iso) {
      const d = new Date(iso);
      if (isNaN(d)) return iso;
      return d.toLocaleDateString("th-TH", { day: "2-digit", month: "2-digit", year: "numeric" });
    },
    toNum(v) {
      if (v == null || v === "") return null;
      const n = Number(String(v).replace(/[^\d.-]/g, ""));
      return Number.isFinite(n) ? n : null;
    },
    parseLegacySalary(txt) {
      if (!txt || typeof txt !== "string") return {};
      const m = txt.match(/(‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á|‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô|‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô|‡πÄ‡∏´‡∏°‡∏≤‡∏á‡∏≤‡∏ô|‡∏ï‡∏≤‡∏°‡∏ï‡∏Å‡∏•‡∏á)?\s*([\d,]+)?\s*(?:[-‚Äì]\s*([\d,]+))?/);
      if (!m) return {};
      return {
        type: m[1] || "",
        min: m[2] ? this.toNum(m[2]) : null,
        max: m[3] ? this.toNum(m[3]) : null,
      };
    },
    parseWorktime(str) {
      // ‡∏û‡∏≤‡∏£‡πå‡∏™‡πÅ‡∏ö‡∏ö‡∏´‡∏¢‡∏≤‡∏ö‡πÜ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö "‡∏à.-‡∏®. 09:00 ‚Äì 17:00" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏à,‡∏≠,‡∏û 10:00 ‚Äì 18:00"
      if (!str) return;
      const parts = String(str).split(" ");
      const dayPart = parts[0] || "";
      const timeMatch = str.match(/(\d{1,2}:\d{2}).*?(\d{1,2}:\d{2})/);
      if (dayPart.includes("‡∏à.-‡∏®.")) this.ui.daysSelected = ["‡∏à", "‡∏≠", "‡∏û", "‡∏û‡∏§", "‡∏®"];
      else {
        const ds = dayPart.split(",").map(s => s.trim()).filter(Boolean);
        if (ds.length) this.ui.daysSelected = ds;
      }
      if (timeMatch) {
        this.ui.startTime = timeMatch[1];
        this.ui.endTime = timeMatch[2];
      }
    },

    // ---------- Mapping API -> Form ----------
    hydrateFormFromApi(j) {
      // ‡∏ä‡∏∑‡πà‡∏≠/‡∏´‡∏°‡∏ß‡∏î/‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î/‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥/‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
      this.job.title         = j.j_title || "";
      this.job.category      = j.j_type || "";
      this.job.description   = j.j_description || "";
      this.job.qualification = j.j_qualification || "";
      this.job.vacancy       = j.j_amount || "";

      // ‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á: ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÉ‡∏´‡∏°‡πà/‡πÄ‡∏Å‡πà‡∏≤
      const legacy = this.parseLegacySalary(j.j_salary);
      this.job.salary_type = j.j_salary_type || j.salary_type || legacy.type || "";
      this.job.salary_min  = this.toNum(j.j_salary_min ?? j.salary_min ?? legacy.min);
      this.job.salary_max  = this.toNum(j.j_salary_max ?? j.salary_max ?? legacy.max);

      // ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤
      if (j.j_duration) {
        if (/‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á/.test(j.j_duration)) this.ui.durationPreset = "‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á";
        else if (/‡∏á‡∏≤‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß/.test(j.j_duration)) this.ui.durationPreset = "‡∏á‡∏≤‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß";
        else this.ui.durationPreset = j.j_duration; // "1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô" / "3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô" / "6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô"
      }

      // ‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
      this.parseWorktime(j.j_worktime);

      // ‡∏ä‡∏ô‡∏¥‡∏î‡∏á‡∏≤‡∏ô ‚Üî ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á (‡∏ú‡∏π‡∏Å‡πÄ‡∏ö‡∏≤‡πÜ)
      if (this.job.salary_type === "‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á") this.ui.kind = "‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á";
      else if (this.job.salary_type === "‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô") this.ui.kind = "‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÑ‡∏ó‡∏°‡πå(‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô)";
      else if (this.job.salary_type === "‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô") this.ui.kind = "‡∏ü‡∏π‡∏•‡πÑ‡∏ó‡∏°‡πå(‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)";
      else this.ui.kind = "‡∏á‡∏≤‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß";
    },

    // ---------- UI Actions ----------
    setKind(kind, salaryType) {
      this.ui.kind = kind;
      if (!this.job.salary_type || this.job.salary_type === "‡πÄ‡∏´‡∏°‡∏≤‡∏á‡∏≤‡∏ô" || this.job.salary_type === "‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á" || this.job.salary_type === "‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô" || this.job.salary_type === "‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô")
        this.job.salary_type = salaryType; // ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á (‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏¢‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏î‡πâ)
    },
    toggleDay(key) {
      const i = this.ui.daysSelected.indexOf(key);
      if (i >= 0) this.ui.daysSelected.splice(i, 1);
      else this.ui.daysSelected.push(key);
    },
    selectWeekdays() {
      this.ui.daysSelected = ["‡∏à", "‡∏≠", "‡∏û", "‡∏û‡∏§", "‡∏®"];
    },
    toggleAllDays() {
      if (this.ui.daysSelected.length === 7) this.ui.daysSelected = [];
      else this.ui.daysSelected = ["‡∏≠‡∏≤", "‡∏à", "‡∏≠", "‡∏û", "‡∏û‡∏§", "‡∏®", "‡∏™"];
    },

    // ---------- Submit ----------
    async submitEdit() {
      const id = this.$route.params.id;

      const payload = {
        j_title: this.job.title,
        j_description: this.job.description,
        j_type: this.job.category,
        j_amount: this.job.vacancy || null,

        j_salary_type: this.job.salary_type || null,
        j_salary_min:  this.job.salary_type === "‡∏ï‡∏≤‡∏°‡∏ï‡∏Å‡∏•‡∏á" ? null : (this.job.salary_min ?? null),
        j_salary_max:  this.job.salary_type === "‡∏ï‡∏≤‡∏°‡∏ï‡∏Å‡∏•‡∏á" ? null : (this.job.salary_max ?? null),

        j_worktime: this.jWorktimeString || null,
        j_deliverable: this.apiJob?.j_deliverable || "", // ‡∏Å‡∏±‡∏ô undefined
        j_qualification: this.job.qualification || null,
        j_duration: this.jDurationString || null,
      };

      try {
        await axios.put(`http://localhost:3001/api/jobs/${id}`, payload);
        alert("‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        this.$router.push(`/employer/jobs/${id}`);
      } catch (err) {
        console.error("‚ùå ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏á‡∏≤‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:", err?.response?.data || err.message);
        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
      }
    },
    cancelEdit() {
      const id = this.$route.params.id;
      this.$router.push(`/employer/jobs/${id}`);
    },
  },
};
</script>

<style scoped>
/* Layout & card */
.container { padding: 24px 16px; }
.card {
  background:#fff; border:1px solid #eef2f7; border-radius:18px;
  padding: 24px 22px; box-shadow: 0 12px 28px rgba(17,24,39,.06);
}
.title { color:#ff6600; font-weight:800; margin:2px 0 18px; }

/* Grid helpers */
.grid { display:grid; }
.grid-2 { grid-template-columns: repeat(2, minmax(0,1fr)); }
.grid-3 { grid-template-columns: repeat(3, minmax(0,1fr)); }
.gap-4 { gap:16px; }
.gap-5 { gap:20px; }

/* Form controls */
.label { font-weight:700; color:#0f172a; font-size:.95rem; margin-bottom:6px; display:block; }
.label.sub { font-weight:600; color:#475569; }
.req { color:#ef4444; }
.input, .select, textarea.input {
  width:100%; border:1px solid #e5e7eb; border-radius:12px; padding:10px 14px;
  font-size:.95rem; outline:none; transition:.15s;
}
.input:focus, .select:focus, textarea.input:focus {
  border-color:#ffd4b3; box-shadow:0 0 0 4px rgba(255,102,0,.12);
}

/* Chips */
.chips { display:flex; flex-wrap:wrap; gap:8px; }
.chip {
  border:1px solid #e6e9f0; background:#fff; padding:8px 12px; border-radius:999px;
  font-weight:700; color:#0f172a; transition:.15s;
}
.chip:hover { box-shadow:0 6px 18px rgba(16,24,40,.06); transform: translateY(-1px); }
.chip.active { background:#fff5e6; border-color:#ffb380; color:#ff6600; }

/* Days selector */
.days { display:flex; flex-wrap:wrap; gap:8px; }
.day {
  border:1px solid #e5e7eb; background:#fff; color:#0f172a; border-radius:10px; padding:8px 10px;
  min-width:42px; text-align:center; font-weight:700;
}
.day.active { background:#0ea5e9; color:#fff; border-color:#0ea5e9; }

/* Summary */
.summary {
  display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:14px;
  border:1px dashed #dbe2ea; border-radius:14px; padding:14px; background:#f8fafc;
}
.sum-item { background:#fff; border:1px solid #eaeef6; border-radius:12px; padding:12px; }
.sum-title { color:#64748b; font-weight:700; font-size:.85rem; }
.sum-val { color:#0f172a; font-weight:800; }

/* Buttons */
.btn-primary {
  width:100%; border:none; background:#ff6600; color:#fff; font-weight:800;
  padding:12px 18px; border-radius:14px; transition:.15s; text-align:center;
}
.btn-primary:hover { background:#e65c00; box-shadow:0 8px 20px rgba(255,102,0,.25); transform:translateY(-1px); }

.btn-outline {
  width:100%; border:1px solid #e5e7eb; background:#fff; color:#0f172a; font-weight:700;
  padding:12px 18px; border-radius:14px;
}
.btn-outline:hover { background:#f8fafc; }
  
@media (max-width: 900px) {
  .grid-2, .grid-3 { grid-template-columns: 1fr; }
  .summary { grid-template-columns: 1fr; }
}
</style>
